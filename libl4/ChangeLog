2004-08-02  Peter Bruin  <pjbruin@dds.nl>

	* powerpc/l4/bits/math.h (__L4_msb): Count leading zeros of
	`data' instead of `data & -data'.
	(__L4_lsb): Call __L4_msb instead of __l4_msb.  Remove unused
	variable `lsb'.

2004-04-26  Marcus Brinkmann  <marcus@gnu.org>

	* l4/ipc.h (__L4_map_item_t, __L4_grant_item_t,
	__L4_string_item_t): New member MR.
	(_L4_msg_append_map_item): Fix use of map_item.
	(_L4_msg_put_map_item): Likewise.
	(_L4_msg_get_map_item): Likewise.
	(_L4_msg_append_grant_item): Fix use of grant_item.
	(_L4_msg_put_grant_item): Likewise.
	(_L4_msg_get_grant_item): Likewise.
	(_L4_msg_append_simple_string_item): Fix use of string item.
	(_L4_msg_append_string_item): Likewise.
	(_L4_msg_put_string_item): Likewise.
	(_L4_msg_get_string_item): Likewise.

2004-04-23  Marco Gerards  <metgerards@student.han.nl>

	* l4/thread.h (__L4_STOP): Don't use _L4_XCHG_REGS_SET_SP and
	_L4_XCHG_REGS_SET_IP.

2004-04-21  Marco Gerards  <metgerards@student.han.nl>

	* Makefile.am (common_headers, l4_headers): Add sigma0.h.
	* headers.m4: Add libl4/l4/sigma0.h, libl4/l4/compat/sigma0.h
	and libl4/l4/gnu/sigma0.h.
	* l4/sigma0.h, l4/compat/sigma0.h, l4/gnu/sigma0.h: New files.

2004-04-21  Marcus Brinkmann  <marcus@gnu.org>

	* l4/gnu/space.h (L4_FPAGE_SPAN_MAX): Increase value.

2004-04-19  Marcus Brinkmann  <marcus@gnu.org>

	* l4/gnu/ipc.h (l4_msg_tag_set_label,
	(l4_msg_tag_set_untyped_words, l4_msg_tag_set_typed_words): New
	functions.

2004-04-10  Marcus Brinkmann  <marcus@gnu.org>

	* l4/thread.h (_L4_THREAD_VERSION_BITS, _L4_THREAD_NO_BITS,
	_L4_anylocalthread): Fix macro.

	* l4/pagefault.h, l4/gnu/pagefault.h: New files.
	* Makefile.am (gnu_headers): Add pagefault.h.
	(l4_headers): Likewise.
	* headers.m4: Add l4/pagefault.h and l4/gnu/pagefault.h.

	* l4/thread-start.h, l4/gnu/thread-start.h: New files.
	* Makefile.am (gnu_headers): Add thread-start.h.
	(l4_headers): Likewise.
	* headers.m4: Add l4/thread-start.h and l4/gnu/thread-start.h.

	* l4/gnu/space.h (L4_FPAGE_SPAN_MAX): New macro.
	(l4_fpage_span): New function.

2004-04-06  Marcus Brinkmann  <marcus@gnu.org>

	* l4/gnu/ipc.h: Revert last change.  Local IPC must always include
	a send and a receive phase.

2004-04-05  Marcus Brinkmann  <marcus@gnu.org>

	* l4/gnu/ipc.h (l4_lwait_timeout, l4_lwait, l4_lreply): New
	functions.

	* l4/syscall.h (_L4_IPC_TIMEOUT, _L4_IPC_NO_PARTNER,
	_L4_IPC_CANCELED, _L4_IPC_MSG_OVERFLOW,
	_L4_IPC_XFER_TIMEOUT_INVOKER, _L4_IPC_XFER_TIMEOUT_PARTNER,
	_L4_IPC_ABORTED): New macros.
	* l4/gnu/syscall.h (L4_IPC_TIMEOUT, L4_IPC_NO_PARTNER,
	L4_IPC_CANCELED, L4_IPC_MSG_OVERFLOW, L4_IPC_XFER_TIMEOUT_INVOKER,
	L4_IPC_XFER_TIMEOUT_PARTNER, L4_IPC_ABORTED): New macros.

2004-04-02  Marcus Brinkmann  <marcus@gnu.org>

	* l4/gnu/space.h (L4_FPAGE_NO_ACCESS): Change L4_FPAGE_NO_ACCESS
	from _l4_no_access to _L4_no_access.

2004-04-01  Marcus Brinkmann  <marcus@gnu.org>

	* ia32/l4/bits/syscall.h (_L4_system_clock): Add "edi" to
	clobbered registers.

	* l4/space.h (_L4_unmap_fpage): Change return type to _L4_fpage_t.
	Return FPAGE.
	(_L4_flush): Likewise.
	* l4/compat/space.h (L4_UnmapFpage): Store the result of
	_L4_unmap_fpage in FPAGE.
	(L4_Flush): Likewise.
	* l4/gnu/space.h (l4_unmap_fpage): Change return type to
	l4_fpage_t.  Return result of _L4_unmap_fpage.
	(l4_flush): Change return type to l4_fpage_t.  Return result of
	_L4_flush.

2004-03-30  Wolfgang Jährling  <wolfgang@pro-linux.de>

	* l4/compat/types.h (L4_Word32_t): New type, as required by
	the L4 specification.

	* README: Doc fixes.

2003-03-30  Wolfgang Jährling  <wolfgang@pro-linux.de>

	* l4/types.h (_L4_WORDSIZE_32, _L4_WORDSIZE_64): Removed.
	All users changed to use numeric constants 32 and 64 instead.
	* l4/gnu/types.h (L4_WORDSIZE_32, L4_WORDSIZE_64): Removed.
	* l4/math.h: All users of _L4_WORDSIZE_32 or _L4_WORDSIZE_64
	changed to use numeric constants 32 and 64 instead.
	* l4/thread.h: Likewise.
	* l4/kip.h: Likewise.  Use _L4_WORDSIZE instead of L4_WORDSIZE.
	* ia32/l4/bits/types.h (_L4_WORDSIZE): Define to 32.
	* powerpc/l4/bits/types.h (_L4_WORDSIZE): Likewise.

2004-03-29  Marcus Brinkmann  <marcus@gnu.org>

	* l4/compat/space.h (L4_Unmap) [_cplusplus]: Remove spurious comma.
	(L4_Flush) [_cplusplus]: Likewise.

2004-03-25  Marcus Brinkmann  <marcus@gnu.org>

	* l4/ipc.h (_L4_msg_put): Rename argument TYPED to ANY_TYPED, add
	new variable TYPED that takes its value in casted form.  Remove
	casts in assignment.
	(_L4_msg_get): Likewise.

2004-03-23  Marcus Brinkmann  <marcus@gnu.org>

	* ia32/Makefile.am (nobase_include_HEADERS): Fix typo that
	prevented l4/bits/gnu/space.h from being installed.  Reported by
	Daniel Wagner.

2004-03-22  Marcus Brinkmann  <marcus@gnu.org>

	* l4/gnu/ipc.h (l4_send_timeout): Call _L4_send_timeout.
	* l4/gnu/schedule.h (l4_is_time_longer): Call _L4_is_time_longer.
	(l4_is_time_shorter): Call _L4_is_time_shorter.
	(l4_is_time_equal): Call _L4_is_time_equal.
	(l4_is_time_not_equal): Call _L4_is_time_not_equal.
	* l4/gnu/kip.h (l4_num_processors_desc_from): Rename to ...
	(l4_num_processors_from): ... this.  Fix implementation.
	(l4_num_processors_desc): Rename to ...
	(l4_num_processors): ... this.  Fix implementation.

2004-03-21  Marcus Brinkmann  <marcus@gnu.org>

	* l4/gnu/schedule.h (l4_SystemClock): Rename to ...
	(l4_system_clock): ... this.

	* ia32/l4/bits/gnu/space.h (l4_io_fpage, l4_io_fpage_log2,
	l4_small_space): Convert to wrapper function.

2004-03-19  Marcus Brinkmann  <marcus@gnu.org>

	* l4/gnu/ipc.h (L4_string_items_acceptor): Rename to ...
	(L4_STRING_ITEMS_ACCEPTOR): ... this.
	(L4_untyped_words_acceptor): Rename to ...
	(L4_UNTYPED_WORDS_ACCEPTOR): ... this.

	* ia32/l4/bits/vregs.h (_L4_utcb): Make the assembler volatile.

2004-03-17  Marcus Brinkmann  <marcus@gnu.org>

	* l4/schedule.h (_L4_TIME_M_BITS, _L4_TIME_PERIOD_E_BITS,
	_L4_TIME_PERIOD_E_MAX): New macros.
	(_L4_time_period): Use them.
	(_L4_zero_time): Use them.
	* l4/gnu/schedule.h (L4_TIME_PERIOD_MAX): Define macro.
	(l4_time_mul2): New function.

	* l4/thread.h (_L4_start, _L4_start_sp_ip, _L4_start_sp_ip_flags):
	Add _L4_XCHG_REGS_CANCEL_IPC to control flags, to match L4 CVS.
	* l4/compat/space.h (L4_UnmapFpage): Change the return type to
	L4_Fpage_t and return the fpage to match L4 CVS.
	(L4_Flush): Likewise.
	* l4/syscall.h (_L4_ERR_INV_SPACE, _L4_ERR_INV_SCHEDULER,
	_L4_ERR_INV_PARAM, _L4_ERR_UTCB_AREA, _L4_ERR_KIP_AREA,
	_L4_ERR_NO_MEM): Decrement by one to match the L4 CVS.

2004-03-17  Johan Rydberg  <jrydberg@night.trouble.net>

	* l4/gnu/kip.h (l4_utcb_alignment_log2): Use void as argument type.
	(l4_utcb_alignment): Likewise.

	* l4/gnu/ipc.h (l_map_item): Rename to ...
	(l4_map_item): ... this.
	(l_is_map_item): Rename to ...
	(l4_is_map_item): ... this.
	(l4_add_cache_allocation_hint_to): Put attribute properly behind type.

	* l4/thread.h (__L4_STOP): Undefine after last use.

2004-03-16  Marcus Brinkmann  <marcus@gnu.org>

	Total overhaul, and I am not going to list all the changes.  Every
	single file, and every single interface has been touched, to be
	able to cleanly provide multiple interfaces in parallel.  The
	compatibility interface has been added.  Some bugs have been
	fixed, some others have been introduced.

2003-10-20  Johan Rydberg  <jrydberg@night.trouble.net>

	* l4/kip.h (l4_page_trunc): New function.
	(l4_page_round): Likewise.
	(l4_atop): Likewise.
	(l4_ptoa): Likewise.

2003-10-16  Johan Rydberg  <jrydberg@night.trouble.net>

	* powerpc/l4/bits/stubs-init.h (__L4_SETUP_SYSCALL): Do correct
	relocation (that means none).

	* powerpc/l4/bits/syscall.h (__L4_PPC_XCLOB): Add ctr and lr.

2003-10-05  Marcus Brinkmann  <marcus@gnu.org>

	* l4/kip.h: Include <l4/math.h>.
	(l4_min_page_size_log2): Reimplement using l4_lsb().

	* l4/math.h (l4_msb): Use __builtin_expect for optimization.
	(l4_lsb): Likewise.

2003-09-25  Marcus Brinkmann  <marcus@gnu.org>

	* powerpc/l4/bits/syscall.h (_L4_EXTERN_STUBS): Define macro and
	include <l4/bits/stubs.h>.  Then undefine it.
	* powerpc/l4/bits/stubs.h: Only error if _L4_EXTERN_STUBS is not
	defined.
	(_L4_EXTERN): New macro.
	(__l4_syscall_stub_t): Define as macro and only add typedef if it
	is not defined yet.
	Use _L4_EXTERN to prefix all system stubs declarations.

	* powerpc/l4/bits/syscall.h (l4_kernel_interface): Remove clobber
	list.

	* powerpc/l4/bits/syscall.h (l4_kernel_interface): Fix setting
	return variables.
	(l4_exchange_registers): Fix typo.
	(l4_space_control): Fix cut and paste bug and use .raw member to
	access fpages and thead ID objects.
	(l4_ipc): Remove superfluous comma.
	(l4_lipc): Likewise.
	* powerpc/l4/bits/math.h (__l4_msb): Add missing name parameter
	for input constraint.
	Submitted by Maurizio Boriani <debauxit@yahoo.it>.

2003-09-25  Marcus Brinkmann  <marcus@gnu.org>

	* l4/types.h (_L4_BITFIELD5): Fix macro definition.

2003-09-24  Maurizio Boriani  <debauxit@yahoo.it>
 
	* l4/types.h (_L4_BITFIELD4): Fix macro definition.
	(_L4_BITFIELD6): Was defined twice.  The second instance is
	renamed to ...
	(_L4_BITFIELD7): ... this.

2003-09-22  Marcus Brinkmann  <marcus@gnu.org>

	* headers.m4: Add arch-dependent files using a shell variable.
	* headers-ia32.m4, headers-powerpc.m4: Files removed.

	* Makefile.am (ARCH_SUBDIR) [ARCH_POWERPC]: Add powerpc.
	* headers-powerpc.m4: New file.
	* powerpc/Makefile.am: New file.
	* powerpc/l4/bits/ipc.h, powerpc/l4/bits/space.h,
	powerpc/l4/bits/types.h, powerpc/l4/bits/kip.h,
	powerpc/l4/bits/stubs-init.h, powerpc/l4/bits/vregs.h,
	powerpc/l4/bits/math.h, powerpc/l4/bits/stubs.h,
	powerpc/l4/bits/misc.h, powerpc/l4/bits/syscall.h: New files.
	
2003-09-19  Marcus Brinkmann  <marcus@gnu.org>

	* l4/init.h: Include <l4/syscall.h>

2003-09-18  Marcus Brinkmann  <marcus@gnu.org>

	* Makefile.am (nobase_include_HEADERS): Add l4/init.h.
	* headers.m4: Likewise.

	* l4/kip.h (L4_MIN_PAGE_SIZE): New macro.
	(l4_memory_desc_high): Return the address of the last byte, not
	the byte following it, according to 20030912 version of the L4 X.2
	specification, revision 4.

	* l4/types.h (__L4_PRI_PREFIX, L4_PRIdWORD, L4_PRIiWORD,
	L4_PRIoWORD, L4_PRIuWORD, L4_PRIxWORD, L4_PRIXWORD, L4_SCNdWORD,
	L4_SCNiWORD, L4_SCNoWORD, L4_SCNuWORD, L4_SCNxWORD, L4_SCNXWORD):
	New macros.

	* l4/types.h (L4_WORD_C): Fix macro.

	* l4.h (l4_init): Move to ...
	* l4/init.h (l4_init): ... here.  New file.

	* l4/kip.h (l4_api_version): Replace with always inlined static
	inline function.
	* l4/thread.h (_L4_EXTERN_INLINE): Do not define.  Replace all
	uses of it with static inline, and mark these functions with
	attribute __always_inline__.
	* l4/ipc.h (_L4_EXTERN_INLINE): Likewise.
	* l4/math.h (_L4_EXTERN_INLINE): Likewise.
	* l4/misc.h (_L4_EXTERN_INLINE): Likewise.
	* l4/schedule.h (_L4_EXTERN_INLINE): Likewise.
	* l4/space.h (_L4_EXTERN_INLINE): Likewise.
	* ia32/l4/bits/math.h (_L4_EXTERN_INLINE): Likewise.
	* ia32/l4/bits/space.h (_L4_EXTERN_INLINE): Likewise.
	* ia32/l4/bits/stubs-init.h (_L4_EXTERN_INLINE): Likewise.
	* ia32/l4/bits/syscall.h (_L4_EXTERN_INLINE): Likewise.
	* ia32/l4/bits/vregs.h (_L4_EXTERN_INLINE): Likewise.
	* l4/kip.h (_L4_EXTERN_INLINE): Likewise.
	* l4.h (_L4_EXTERN_INLINE): Likewise.
	* ia32/l4/bits/vregs.h (__l4_utcb): Mark with attributes
	always_inline and const.
	* globals.c, ipc.c, kip.c, l4.c, math.c, misc.c, schedule.c,
	space.c, stubs-init.c, stubs.c, syscall.c, thread.c, vregs.c:
	Files removed.
	* Makefile.am (lib_LIBRARIES): Variable removed.
	(libl4_a_SOURCES): Likewise.
	(libl4_a_CFLAGS): Likewise.

2003-09-18  Marcus Brinkmann  <marcus@gnu.org>

	* l4/kip.h (l4_get_kernel_interface): Rename to ...
	(l4_kip): ... this.  Also in all callers.
	* ia32/l4/bits/stubs-init.h (__L4_SETUP_SYSCALL): Likewise in
	caller.

	* l4/kip.h (l4_min_page_size): New function.
	(l4_min_page_size_log2): Likewise.

	* l4/types.h (L4_WORD_C): Define macro.

2003-09-17  Marcus Brinkmann  <marcus@gnu.org>

	* l4/math.h (__l4_msb): Rename to ...
	(l4_msg): ... this.  Return 1 more, so the least significant bit
	is 1 (to match ffs() behaviour).  Call __l4_msb(), not
	__l4_msb_().
	(l4_lsb): New function.
	* ia32/l4/bits/math.h (__l4_msb_): Rename to ...
	(__l4_msb): ... this.  Add one to result.
	(__l4_lsb): New function.
	* l4/space.h (l4_fpage): Subtract one from MSB.  Check that size
	is not zero before using MSB.

2003-09-08  Marcus Brinkmann  <marcus@gnu.org>

	* l4/space.h (l4_is_nil_fpage): New function.
	(l4_complete_address_space): Fix initializer.

	* l4/types.h: Fix size of error field.

	* l4/ipc.h (l4_ipc_succeeded): Invert return value.
	(l4_ipc_failed): Likewise.
	(l4_msg_word): New function.

2003-07-26  Marcus Brinkmann  <marcus@gnu.org>

	* Initial check-in.

