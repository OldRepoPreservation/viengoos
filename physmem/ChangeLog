2004-11-01  Marcus Brinkmann  <marcus@gnu.org>

	* container.c: Include "zalloc.h".
	* physmem.c (create_bootstrap_caps): Remove unused variables
	STARTUP_CAP, NR_FPAGES, FPAGES.

2004-10-29  Marcus Brinkmann  <marcus@gnu.org>

	* ia32-cmain.c (switch_thread): Correct start of small sub stack
	address.  Reported by Rian Hunter <hurd@thelaststop.net>.

2004-10-28  Marcus Brinkmann  <marcus@gnu.org>

	* physmem.c (get_task_cap): Removed.
	(bootstrap_final): New function.
	(main): Call bootstrap_final, not get_task_cap.

2004-10-27  Marcus Brinkmann  <marcus@gnu.org>

	* container.c (container_map): Call l4_fpage_xspan instead of
	l4_fpage_span.

2004-10-25  Marcus Brinkmann  <marcus@gnu.org>

	* physmem.c (physmem_server): Call hurd_cap_bucket_worker_alloc.

2004-10-20  Marcus Brinkmann  <marcus@gnu.org>

	* malloc-wrap.c: Do not include zalloc.h here.
	(USE_MALLOC_LOCK): Define.

2004-07-16  Bas Wijnen  <b.wijnen@phys.rug.nl>

	* physmem.c (physmem_server): Added missing parameter.

2004-04-26  Marcus Brinkmann  <marcus@gnu.org>

	* physmem.c: Include <hurd/wortel.h>.
	(wortel_thread_id, wortel_cap_id): New variables.
	(get_all_memory): Rewritten using wortel interface.
	(create_bootstrap_caps): Likewise.
	(get_threads): Likewise.
	(get_task_cap): Likewise.
	(main): Initialize wortel_thread_id.
	* output.c (shutdown): Include <hurd/wortel.h>.
	(shutdown): Rewritten using wortel interface.
	(putchar): Rewritten using wortel interface.

2004-04-15  Marcus Brinkmann  <marcus@gnu.org>

	* container.c (container_map): New function.
	(container_demux): Call container_map.

2004-04-11  Marcus Brinkmann  <marcus@gnu.org>

	* physmem.c (get_task_cap): New function.
	(main): Call get_task_cap.

	* container.c (container_reinit): Unmap the fpages before
	returning them to the pool.

2004-04-10  Marcus Brinkmann  <marcus@gnu.org>

	* container.c: Include <l4/space.h>.  Use L4_FPAGE_SPAN_MAX
	instead MAX_FPAGES everywhere.
	(container_reinit): New function.
	(container_class_init): Pass container_reinit as reinit function.
	(MAX_FPAGES): Removed.

2004-04-09  Marcus Brinkmann  <marcus@gnu.org>

	* container.c: Revert last change.
	* physmem.h: Revert last change.
	* physmem.c (MAX_FPAGES): Removed macro.
	(create_bootstrap_caps): Use L4_FPAGE_SPAN_MAX, not MAX_FPAGES.
	Update bootstrap cap code to new wortel interface (essentially
	reverting the last change).

	* physmem.h: Include <stdbool.h>.
	* container.c (struct container): Add member mapped.
	(container_alloc): Add new argument mapped.  Initialize
	CONTAINER->mapped.

	* Makefile.am (physmem_LDADD): Add
	../libhurd-cap-server/libhurd-cap-server.a and
	../libhurd-slab/libhurd-slab.a.
	(physmem_SOURCES): Add container.c.
	* container.c: New file.
	* physmem.h: Include <hurd/cap-server.h> and <errno.h>.
	(container_class_init, container_alloc): New prototypes.
	* physmem.c (create_bootstrap_caps): Take new argument bucket.
	Create container capabilities and inject them into the bucket.
	(getpagesize): New temporary helper function.
	(physmem_server): New function.
	(main): New variable BUCKET.  Create capability bucket.  Pass
	BUCKET to create_bootstrap_caps.  New variable MANAGER.  Create
	manager thread.

2004-04-06  Marcus Brinkmann  <marcus@gnu.org>

	* physmem.c (setup_threads): Add threads to pool after creating
	main thread.  Don't overwrite server_thread with an incorrect
	value at the end.

2004-03-19  Marcus Brinkmann  <marcus@gnu.org>

	* physmem.c (WORTEL_MSG_GET_THREADS): New macro.
	(setup_threads): Request number of extra threads from wortel.  Add
	them to the pool.

	* output.h (shutdown): Add noreturn attribute to prototype.
	* output.c (shutdown): Add noreturn attribute.  Sleep forever.

	* config.m4 (HURD_LOAD_ADDRESS): Change load address to 0x400000.
	* physmem.c: Include pthread.h.
	(setup_threads): New function.
	(main): New variable SERVER_THREAD.  Call setup_threads.
	(exit, abort): New functions.
	* physmem.h (switch_thread): Add prototype.
	* ia32-cmain.c (switch_thread): New function.
	(__thread_stack_pointer): New macro.
	(__thread_set_stack_pointer): New macro.
	* Makefile.am (physmem_LDADD): Add ../libpthread/libpthread.a and
	../libhurd-ihash/libhurd-ihash.a.

2004-03-16  Marcus Brinkmann  <marcus@gnu.org>

	* output.c (putchar): Replace all &msg with msg.  Update
	everything to new API.
	* physmem.c: Likewise.

2003-10-26  Marcus Brinkmann  <marcus@gnu.org>

	* Makefile.am (physmem_CPPFLAGS): Use top_builddir for include
	directory.

2003-10-24  Daniel Wagner  <wagi@gmx.ch>

	* Makefile.am (physmem_CPPFLAGS): Use top_scrdir instead of 
	top_builddir.

2003-10-16  Marcus Brinkmann  <marcus@gnu.org>

	* output.c (shutdown): New function.
	* physmem.c: Include <stdlib.h>.
	(get_all_memory): Update to match new wortel interface.
	(create_bootstrap_caps): New function.
	(main): Call create_bootstrap_caps.

2003-10-12  Marcus Brinkmann  <marcus@gnu.org>

	* config.m4: New file.
	* Makefile.am (physmem_LDFLAGS): Replace load address with
	@HURD_PHYSMEM_LOAD_ADDRESS@.

2003-09-24  Marcus Brinkmann  <marcus@gnu.org>

	* mmap.c: New file.
	* Makefile.am (physmem_SOURCES): Add mmap.c.
	* malloc-wrap.c (LACKS_SYS_MMAN_H, mmap, munmap, PROT_READ,
	PROT_WRITE, MAP_PRIVATE, MAP_ANONYMOUS, MUNMAP_FAILURE): Remove
	macros.

2003-09-22  Marcus Brinkmann  <marcus@gnu.org>

	* Makefile.am (AM_CPPFLAGS, physmem_CFLAGS): Removed.
	(physmem_CPPFLAGS): New variable.
	(physmem_SOURCES): Add malloc-wrap.c.
	(EXTRA_physmem_SOURCES): New variable.
	* malloc.c, malloc-wrap.c: New files.

2003-09-21  Marco Gerards  <metgerards@student.han.nl>

	* Makefile.am (AM_CPPFLAGS): New variable.

2003-09-19  Marcus Brinkmann  <marcus@gnu.org>

	* physmem.c: Include "zalloc.h".
	* zalloc.c: Include <string.h>, not <strings.h>.
	(add_block): Add missing return type.
	(zalloc_dump_zones): Use %p for pointer.

	* zalloc.c (L4_MIN_PAGE_SHIFT): Remove macro.
	(ZONE_SIZE): Use L4_MIN_PAGE_SIZE_LOG2 instead of L4_MIN_PAGE_SHIFT.
	(ZONES): Likewise.
	(zfree): Likewise.
	(zalloc): Likewise.

	* physmem/Makefile.am (physmem_SOURCES): Remove getpagesize.c.
	* getpagesize.c: File removed.
	* physmem/zalloc.c (zfree): Use l4_min_page_size() instead
	getpagesize().
	(zalloc): Likewise.
	(zalloc_dump_zones): Likewise.
