2005-01-11  Neal H. Walfield  <neal@gnu.org>

	* Makefile.am (task_SOURCES): Remove physmem-user.h and
	physmem-user.c.
	(task_LDADD): Add ../libhurd-btree/libhurd-btree.a and
	../libhurd-mm/libhurd-mm.a.
	* ia32-cmain.c: Include <hurd/mm.h>.
	(pager_tid): New global variable.
	(cmain): Allocate a thread that the memory management subsystem
	can use as the pager thread.  Call hurd_mm_init.  Set the
	PAGER_TID as the current thread's pager.
	* mmap.c: Rewrite to use new interfaces.
	* physmem-user.h: Remove obsolete file.
	* physmem-user.c: Likewise.

2005-01-07  Neal H. Walfield  <neal@gnu.org>

	* output.h (debug): Preface __VA_ARGS__ with ## thereby making it
	optional.

2005-01-07  Neal H. Walfield  <neal@gnu.org>

	* thread.c (threads): Supply the allocate_buffer and
	deallocate_buffer arguments to HURD_SLAB_SPACE_INITIALIZER to
	conform with the new semantics.

2004-12-01  Neal H. Walfield  <neal@gnu.org>

	* physmem-user.h (physmem_map): Change CONT from a hurd_cap_id_t
	to a hurd_cap_handle_t.
	* physmem-user.c (physmem_map): Likewise.

2004-11-17  Neal H. Walfield  <neal@gnu.org>

	* Makefile.am (bootdir): New variable.
	(boot_PROGRAMS): Use this instead of noinst_PROGRAMS.

2004-11-17  Neal H. Walfield  <neal@gnu.org>

	* output.h (debug): Include program_name and __FUNCTION__ in
	output.

2004-11-02  Marcus Brinkmann  <marcus@gnu.org>

	* Makefile.am (task_SOURCES): Add thread.c.
	* thread.c: New file.
	* task.h (struct thread): New structure.
	(thread_t): New typedef.
	(thread_set_range, thread_alloc_with_id, thread_alloc,
	thread_dealloc): New prototype.
	(struct task): Change type of member TASK_ID to hurd_task_id_t.
	Change type of member THREADS to thread_t.
	* task-class.c (task_reinit): Walk what is now the list of
	threads.
	(task_thread_alloc): Implement.
	(task_demuxer): Change msg ID of task_thread_alloc RPC (256 was
	taken by the cap-server implementation).
	(task_alloc): Create the list of threads.
	* task.c: Remove superflusous newlines from panic messages.
	(first_free_thread_no): Move global variable to ...
	(setup_threads): ... here (as local).  Call thread_set_range.

2004-11-01  Marcus Brinkmann  <marcus@gnu.org>

	* task.h (struct task): Remove member OBJ.
	(task_alloc): Change type of last argument to pointer to task_t.
	(task_id_get_task): Use hurd_cap_obj_from_user.
	* task.c (create_bootstrap_caps): Remove variable STARTUP_CAP.
	Add variable TASK.  Use hurd_cap_obj_to_user.
	* task-class.c (task_reinit): Use hurd_cap_obj_to_user instead of
	cast.
	(task_class_init): Use type instead size and alignment.
	(task_alloc): Change type of last argument to pointer to task_t.
	Add new variable OBJ and use it as a temporary placeholder.

2004-10-29  Marcus Brinkmann  <marcus@gnu.org>

	* Makefile.am (task_SOURCES): Add task-id.c.
	* task.h (task_id_to_task_lock, task_id_to_task): New declarations.
	(task_id_get_task): New static inline function.
	(task_id_enter, task_id_add): New prototypes.
	* task.c (create_bootstrap_caps): Enter the new tasks into the
	hash table with task_id_enter.
	* task-id.c: New file.

	* ia32-cmain.c (switch_thread): Correct start of small sub stack
	address.  Reported by Rian Hunter <hurd@thelaststop.net>.

2004-10-28  Marcus Brinkmann  <marcus@gnu.org>

	* task.c (bootstrap_final): New function.
	(main): Call bootstrap_final.

2004-10-27  Marcus Brinkmann  <marcus@gnu.org>

	* Makefile.am (task_SOURCES): Add physmem-user.h, physmem-user.c,
	malloc-wrap.c, mmap.c and task-class.c.
	(EXTRA_task_SOURCES): New target.
	* physmem-user.h, physmem-user.h, malloc.c, malloc-wrap.c, mmap.c,
	task-class.c: New files.
	* task.h (task_class_init, task_alloc): Add prototypes.
	* task.c: Include <hurd/startup.h> and <hurd/wortel.h>
	(__hurd_startup_data): New declaration.
	(create_bootstrap_caps, get_task_id, setup_threads, task_server):
	New functions.
	(first_free_thread_no): New global variable.
	(main): Call setup_threads and initialize server_thread.  Call
	task_class_init. Create task bucket.  Create manager thread and
	start it.
	
	* ia32-cmain.c (cmain): Access cap_handle member in startup_data,
	not cap_id.

2004-10-26  Marcus Brinkmann  <marcus@gnu.org>

	* ia32-crt0.S (__hurd_startup_data): New symbol.
	(_start): Save the first argument on the stack in
	__hurd_startup_data.
	* ia32-cmain.c: Include <hurd/startup.h>.
	(__hurd_startup_data): New prototype.
	(wortel_thread_id, wortel_cap_id): Do not initialize statically.
	(cmain): Initialize wortel_thread_id and wortel_cap_id.

2004-04-26  Marcus Brinkmann  <marcus@gnu.org>

	* ia32-cmain.c: Include <hurd/wortel.h>.
	(wortel_thread_id, wortel_cap_id): New variables.
	* output.c (shutdown): Include <hurd/wortel.h>.
	(shutdown): Rewritten using wortel interface.
	(putchar): Rewritten using wortel interface.
	* task.c: Remove WORTEL_* macros.

2004-04-15  Marcus Brinkmann  <marcus@gnu.org>

	* Initial check-in.

