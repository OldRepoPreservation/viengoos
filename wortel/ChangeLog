2004-04-11  Marco Gerards  <metgerards@student.han.nl>

	* wortel.c (serve_requests): Initialize from specifier.

2004-04-11  Marcus Brinkmann  <marcus@gnu.org>

	* wortel.c (serve_bootstrap_requests): Initialize from specifier.
	Reported by Marco Gerards.

	* Makefile.am (wortel_SOURCES): Add startup-bin.S.
	(noinst_PROGRAMS): Add startup.
	(STARTUP_ARCH_SOURCES): New variable.
	(startup_CPPFLAGS, startup_SOURCES, startup_LDFLAGS)
	(startup_LDADD): New variables.
	* startup-bin.S, ia32-startup.S, startup.c: New files.
	* wortel.c (startup_bin_start, startup_bin_end): New declarations.
	(STARTUP_LOAD_ADDR): New macro.
	(start_task): New function.
	(WORTEL_MSG_GET_TASK_CAP): New macro.
	(serve_bootstrap_requests): Implement the first half of the
	WORTEL_MSG_GET_TASK_CAP RPC.

2004-04-10  Marcus Brinkmann  <marcus@gnu.org>

	* wortel.h (struct wortel_module): New member task_id.
	(enum wortel_module_type): New modules MOD_DEVA and
	MOD_DEVA_STORE.
	(MOD_IS_TASK): New macro.
	* wortel.c: Include <assert.h>, <l4/thread-start.h> and
	<l4/pagefault.h> Throughout the whole file, use map items instead
	of grant items, use L4_FPAGE_SPAN_MAX instead MAX_FPAGES, and use
	l4_fpage_span instead make_fpages.
	(mod_names): Add names for MOD_DEVA and MOD_DEVA_STORE.
	(MAX_FPAGES): Removed.
	(make_fpages): Removed.
	(start_components): Split up into ...
	(setup_components): ... this new function ...
	(start_physmem): ... and this.
	(serve_bootstrap_requests): Rewrite the container creation.
	(main): Call setup_components and start_physmem instead
	start_components.
	
2004-04-09  Marcus Brinkmann  <marcus@gnu.org>

	* wortel.c (serve_bootstrap_requests): Replace start and end in
	the WORTEL_MSG_GET_CAP_REQUEST reply with startup.
	(physmem_master): Change type to hurd_cap_handle_t.
	(hurd_task_id_t): Remove typedef.
	(HURD_TASK_ID_NULL): Remove macro.

	* wortel.h: Include <hurd/types.h>, not <hurd/caps.h>.
	(struct wortel_module): New member startup and startup_cont.
	Change typ of member mem_cont and task_ctrl to hurd_cap_handle_t.

2004-03-30  Marcus Brinkmann  <marcus@gnu.org>

	* loader.c (loader_elf_dest, loader_elf_load): Use 32 and 64
	instead of _L4_WORDSIZE_32 and _L4_WORDSIZE_64.
	
2004-03-19  Marcus Brinkmann  <marcus@gnu.org>

	* wortel.c (WORTEL_MSG_GET_THREADS): New.
	(serve_bootstrap_requests): Implement it.

	* wortel.h (struct wortel_module): Remove member main_thread and
	add member nr_extra_threads.
	* wortel.c (start_components): Use server_thread instead of
	main_thread, set up nr_extra_threads.  Set up the second physmem
	thread.

2004-03-16  Marcus Brinkmann  <marcus@gnu.org>

	* sigma0.c: Rewritten to use new interface.
	* wortel.c (make_fpages): Use L4_FPAGE_FULLY_ACCESSIBLE, not
	l4_fully_accessible.
	(start_components): Use new message interface.
	(serve_bootstrap_requests): Likewise.
	* loader.h (loader_get_memory_desc): Change return type to
	l4_memory_desc_t *.
	* wortel.c (loader_get_memory_desc): Change return type to
	l4_memory_desc_t *.
	* loader.c (mem_check): Change type of MEMDESC to l4_memory_desc_t *.
	* shutdown.c (halt): Use L4_NEVER, not l4_never.
	* ia32-cmain.c (add_unused_area): Use L4_FPAGE_FULLY_ACCESSIBLE,
	not l4_fully_accessible.

2003-10-26  Marcus Brinkmann  <marcus@gnu.org>

	* Makefile.am (AM_CPPFLAGS): Removed.
	(wortel_CFLAGS): Rename to ...
	(wortel_CPPFLAGS): Add AM_CPPFLAGS.  Change
	-I$(top_srcdir)/include to -I$(top_builddir).

2003-10-12  Marcus Brinkmann  <marcus@gnu.org>

	* config.m4: New file.
	* Makefile.am (wortel_LDFLAGS): Replace load address with
	@HURD_WORTEL_LOAD_ADDRESS@.

2003-10-04  Marcus Brinkmann  <marcus@gnu.org>

	* loader.c: Include <l4/kip.h>.
	(mem_check): Change type of address args to l4_word_t.  Use
	l4_memory_desc_low and l4_memory_desc_high to determine range of
	memory descriptor.  The high address is inclusive now, so take
	this into account.  Allow conventional memory descriptors to
	override non-conventional.  Use L4_PRIxWORD.

2003-10-01  Johan Rydberg  <jrydberg@night.trouble.net>

	* wortel.c (serve_bootstrap_requests): Only throw away page zero
	if it list as conventinal in memory descriptors.

2003-09-29  Marcus Brinkmann  <marcus@gnu.org>

	* loader.c (loader_elf_load): Fix wordsize check.  Submitted by
	Johan Rydberg.

2003-09-25  Marcus Brinkmann  <marcus@gnu.org>

	* loader.c [HAVE_CONFIG_H]: Include <config.h>.
	(loader_elf_load): Rewritten architecture check of ELF binary,
	support PPC now.

2003-09-25  Marcus Brinkmann  <marcus@gnu.org>

	* elf.h: Remove cruft.

2003-09-21  Marco Gerards  <metgerards@student.han.nl>

	* output-serial.c (serial_init): Make sure the order of the
	arguments of outb are correct.

	* Makefile.am (AM_CPPFLAGS): New variable.

2003-09-20  Marcus Brinkmann  <marcus@gnu.org>

	* wortel.h (MAX_UNUSED_FPAGES): Move to here from wortel.c.
	(wortel_unused_fpages, wortel_unused_fpages_count): Declare here.
	* ia32-cmain.c: Include "sigma0.h".
	(add_unused_area): New function.
	(find_components): Use add_unused_area to add unused fpages to
	pool.

2003-09-19  Marcus Brinkmann  <marcus@gnu.org>

	* output-serial.c: Include <stdlib.h>.

	* Makefile.am (wortel_SOURCES): Remove getpagesize.c.
	* getpagesize.c: File removed.
	* wortel.c (make_fpages): Use l4_min_page_size, not getpagesize().
	(load_components): Likewise.
	(serve_bootstrap_requests): Likewise.
	(MAX_FPAGES): Use L4_MIN_PAGE_SIZE_LOG2 instead
	hard-coded 10.
	(serve_bootstrap_requests): Likewise.

	* Makefile.am (wortel_CFLAGS): Add -I$(top_srcdir)/libc-parts.
	* output.c: Include <stdlib.h> and <string.h>.
	* output.h (struct output_driver): Add CFG argument to INIT
	function.
	(output_init): Make NAME argument const, rename it to DRIVER.
	* output.c (output_init): Likewise.  Only check if the prefix of
	DRIVER is a driver name.  Then skip a trailing comma and pass the
	remainder via the new variable DRIVER_CFG to the init function of
	the driver.
	* output-vga.c (vga_init): Add CFG argument.
	* output-serial.c: New file by Daniel Wagner <wagi@gmx.de>.

